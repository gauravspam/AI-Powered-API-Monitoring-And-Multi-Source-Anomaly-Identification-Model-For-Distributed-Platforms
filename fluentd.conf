<label @FLUENT_LOG>
  <match fluent.**>
    @type null
  </match>
</label>

<source>
  @type http
  port 9880
  bind "0.0.0.0"
</source>

<match api-logs.**>
  @type opensearch
  host opensearch
  port 9200
  scheme http
  user admin
  password Str0ng@ApiMon#2025
  logstash_format true
  logstash_prefix "api-logs"

  # MEMORY BUFFER - NO DISK!
  buffer_type memory
  buffer_chunk_limit_size 2m
  buffer_queue_limit_length 32

  index_name api-logs-${record['timestamp'].sub(/T.*/, '').gsub('-', '.') || "2026.01.09"}
  type_name _doc

  <format>
    @type json
  </format>

</match>

<match **>
  @type stdout
</match>
